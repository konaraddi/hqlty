# Plan: Migrate from 11ty to Docusaurus 3.9

## Overview

Replace 11ty with Docusaurus 3.9 as the static site generator for odap. Use docs-only mode so patterns are served at the site root. Use Docusaurus defaults for theme, dark mode, sidebar navigation, sitemap, and robots.txt.

## What We're Doing

- Replace 11ty with Docusaurus 3.9
- Migrate all 29 pattern markdown files to Docusaurus docs format
- Migrate the About page as a standalone page (`src/pages/about.md`)
- Use **docs-only mode** (`routeBasePath: '/'`) so the docs sidebar is the primary navigation and homepage
- Use autogenerated sidebar ordered alphabetically
- Use Docusaurus built-in dark mode toggle, sitemap, robots.txt
- Disable blog, search, i18n, versioning

## What We're NOT Doing

- Custom CSS/styling (use Docusaurus defaults)
- Search (not needed now)
- Internationalization (not needed now)
- Blog functionality
- Doc versioning
- Migrating the HN digest script (`scripts/fetch_hn.py`) or `digests/` directory
- Modifying the `scripts/` directory
- Modifying CI/CD workflows beyond the build command

## Current State (Reference)

### Directory structure
```
/home/user/odap/
├── .eleventy.js              # 11ty config - TO DELETE
├── .eleventyignore           # 11ty ignore - TO DELETE
├── .gitignore                # Update (add build/, .docusaurus/)
├── package.json              # Rewrite for Docusaurus
├── CLAUDE.md                 # Keep as-is
├── README.md                 # Keep as-is
├── scripts/                  # Keep as-is (not part of site)
│   └── fetch_hn.py
├── digests/                  # Keep as-is (not part of site)
├── src/
│   ├── _data/site.json       # TO DELETE (metadata moves to docusaurus.config.js)
│   ├── _includes/layout.11ty.js  # TO DELETE
│   ├── p/                    # 29 pattern .md files - TO MIGRATE to docs/p/
│   │   ├── _template.md      # Update for new frontmatter format
│   │   └── p.11tydata.json   # TO DELETE (defaults handled by Docusaurus)
│   ├── static/styles.css     # TO DELETE (using Docusaurus defaults)
│   ├── index.md              # TO DELETE (replaced by docs-only mode homepage)
│   ├── about.md              # TO MIGRATE to src/pages/about.md
│   ├── robots.txt.njk        # TO DELETE (Docusaurus auto-generates)
│   └── sitemap.njk           # TO DELETE (Docusaurus auto-generates)
```

### Current site metadata (from src/_data/site.json)
```json
{
  "name": "odap",
  "url": "https://odap.konaraddi.com",
  "description": "A reference for online discourse antipatterns: the subtle conversation moves that sound reasonable but derail productive discussion."
}
```

### Current pattern frontmatter format
```yaml
---
slug: hindsight-dismissal
title: Hindsight Dismissal
---
```

The `layout` and `tags` fields are injected by `p.11tydata.json` and are 11ty-specific.

### Current URL structure
- Homepage: `/`
- Patterns: `/p/<slug>/` (e.g., `/p/hindsight-dismissal/`)
- About: `/about/`

## Target State

### Directory structure
```
/home/user/odap/
├── docusaurus.config.js      # NEW - main Docusaurus config
├── sidebars.js               # NEW - sidebar config (autogenerated)
├── package.json              # REWRITTEN for Docusaurus
├── .gitignore                # UPDATED
├── CLAUDE.md                 # Unchanged
├── README.md                 # Unchanged
├── scripts/                  # Unchanged
├── digests/                  # Unchanged
├── docs/                     # NEW - all docs content
│   └── p/                    # Migrated patterns
│       ├── _template.md      # Updated template with new frontmatter
│       ├── achievement-minimization.md
│       ├── ... (all 28 pattern files)
│       └── vague-they.md
├── src/
│   └── pages/
│       └── about.md          # Migrated about page
└── static/                   # Docusaurus static dir (empty for now)
```

### Target pattern frontmatter format
```yaml
---
title: Hindsight Dismissal
---
```

Notes:
- `slug` is removed; Docusaurus uses the filename as the URL slug by default, which already matches (e.g., `hindsight-dismissal.md` becomes `/p/hindsight-dismissal`)
- `priority` is removed; patterns are sorted alphabetically by Docusaurus autogenerated sidebar
- `layout` and `tags` are removed (11ty-specific)

### Target docusaurus.config.js
```javascript
import { themes as prismThemes } from 'prism-react-renderer';

/** @type {import('@docusaurus/types').Config} */
const config = {
  title: 'online discourse anti-patterns',
  tagline: 'A reference for online discourse antipatterns: the subtle conversation moves that sound reasonable but derail productive discussion.',
  url: 'https://odap.konaraddi.com',
  baseUrl: '/',
  onBrokenLinks: 'throw',
  onBrokenMarkdownLinks: 'warn',
  i18n: {
    defaultLocale: 'en',
    locales: ['en'],
  },
  presets: [
    [
      'classic',
      /** @type {import('@docusaurus/preset-classic').Options} */
      ({
        docs: {
          routeBasePath: '/',
          sidebarPath: './sidebars.js',
        },
        blog: false,
        theme: {
          customCss: [],
        },
      }),
    ],
  ],
  themeConfig:
    /** @type {import('@docusaurus/preset-classic').ThemeConfig} */
    ({
      navbar: {
        title: 'odap',
        items: [
          { to: '/about', label: 'About', position: 'right' },
          {
            href: 'https://github.com/konaraddi/odap',
            label: 'GitHub',
            position: 'right',
          },
        ],
      },
      colorMode: {
        defaultMode: 'light',
        respectPrefersColorScheme: true,
      },
    }),
};

export default config;
```

### Target sidebars.js
```javascript
/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */
const sidebars = {
  patternsSidebar: [
    {
      type: 'autogenerated',
      dirName: 'p',
    },
  ],
};

export default sidebars;
```

### Target homepage doc
Create `docs/index.md`:
```yaml
---
title: online discourse anti-patterns
sidebar_position: 0
slug: /
---
```
With a brief description and note that patterns are listed in the sidebar. This replaces the current Liquid-template homepage.

### Target about page
Create `src/pages/about.md` with the current about page content, removing 11ty frontmatter (`layout`, `eleventyExcludeFromCollections`).

## Execution Tasks

### Task 1: Scaffold Docusaurus and verify it boots

**Do:**
1. Remove 11ty dependencies from `package.json`
2. Create `docusaurus.config.js` as specified above
3. Create `sidebars.js` as specified above
4. Create `docs/index.md` as the homepage
5. Create one test pattern file (e.g., `docs/p/hindsight-dismissal.md`) with new frontmatter
6. Add `@docusaurus/core`, `@docusaurus/preset-classic`, `prism-react-renderer`, `react`, `react-dom` to dependencies
7. Update `package.json` scripts: `"start": "docusaurus start"`, `"build": "docusaurus build"`
8. Run `npm install`

**Feedback loop:** Run `npm run start` and verify:
- [ ] Dev server starts on localhost:3000
- [ ] Homepage renders at `/`
- [ ] The test pattern renders at `/p/hindsight-dismissal`
- [ ] Sidebar shows the test pattern
- [ ] Dark mode toggle works

### Task 2: Migrate all pattern content

**Do:**
1. For each of the 29 pattern `.md` files in `src/p/`:
   - Copy to `docs/p/`
   - Remove `slug` from frontmatter (filename already matches)
   - Remove `priority` from frontmatter (patterns sort alphabetically)
   - Keep all body content unchanged (markdown content is compatible)
2. Update `docs/p/_template.md` with new frontmatter format

**Feedback loop:** Run `npm run start` and verify:
- [ ] All 29 patterns appear in the sidebar
- [ ] Sidebar order is alphabetical
- [ ] Each pattern page renders correctly (content, headings, examples all display)
- [ ] No broken links or warnings in the console

### Task 3: Migrate About page and clean up homepage

**Do:**
1. Create `src/pages/about.md` from current `src/about.md`, removing 11ty frontmatter
2. Finalize `docs/index.md` homepage content

**Feedback loop:** Run `npm run start` and verify:
- [ ] About page renders at `/about`
- [ ] Navbar "About" link works
- [ ] Homepage displays correctly at `/`
- [ ] Navbar "GitHub" link works

### Task 4: Delete 11ty files and update configs

**Do:**
1. Delete these files:
   - `.eleventy.js`
   - `.eleventyignore`
   - `src/_data/` (entire directory)
   - `src/_includes/` (entire directory)
   - `src/static/` (entire directory)
   - `src/index.md`
   - `src/about.md`
   - `src/robots.txt.njk`
   - `src/sitemap.njk`
   - `src/p/` (entire directory, content already migrated to `docs/p/`)
2. Update `.gitignore`:
   ```
   .DS_Store
   node_modules/
   _site/
   build/
   .docusaurus/
   __pycache__/
   ```
3. Remove `moment` from devDependencies (was unused with 11ty, not needed)
4. Create empty `static/` directory at project root (Docusaurus convention for static assets)

**Feedback loop:** Run `npm run build` and verify:
- [ ] Build succeeds with no errors
- [ ] No 11ty artifacts remain
- [ ] `build/` directory contains the generated site
- [ ] `build/p/hindsight-dismissal/index.html` exists (spot check)
- [ ] `build/about/index.html` exists

### Task 5: Verify production build and document deployment changes

**Do:**
1. Run `npm run build` and inspect output
2. Verify key URLs exist in `build/` output
3. Note the Vercel dashboard changes needed:
   - Build command: `npm run build` (likely unchanged)
   - Output directory: `build` (was `_site`)
   - Node version: 20

**Feedback loop:**
- [ ] `npm run build` exits 0
- [ ] `build/index.html` exists (homepage)
- [ ] `build/p/*/index.html` exist for all patterns
- [ ] `build/about/index.html` exists
- [ ] `build/sitemap.xml` exists
- [ ] No console warnings about broken links

## Adding New Patterns (Post-Migration Workflow)

To add a new pattern after migration:
1. Copy `docs/p/_template.md` to `docs/p/your-pattern-name.md`
2. Fill in frontmatter: `title`
3. Write the pattern content following the structure in CLAUDE.md
4. Run `npm run start` to preview

This is the same simplicity as the current workflow (drop a file in a directory), just with a different directory path and slightly different frontmatter.

## Vercel Deployment Changes

After merging the migration to main, update in the Vercel dashboard:
- **Output directory**: Change from `_site` to `build`
- **Build command**: `npm run build` (should already be this)
- **Node.js version**: Ensure it's set to 20

## Risks and Mitigations

| Risk | Mitigation |
|------|------------|
| URL changes break existing links | Docusaurus uses filename as slug; filenames match current slugs. Trailing slash behavior may differ slightly but Docusaurus handles this gracefully. |
| Pattern content has 11ty-specific syntax | The pattern files are pure markdown with no Liquid/Nunjucks templates. Only `index.md` used Liquid (for the pattern list), and that's being replaced. |
| Build fails on Vercel | Test `npm run build` locally before merging. Update Vercel settings before/after deploy. |
